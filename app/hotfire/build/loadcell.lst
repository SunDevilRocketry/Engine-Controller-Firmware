ARM GAS  /tmp/ccv5mkc5.s 			page 1


   1              		.cpu cortex-m7
   2              		.arch armv7e-m
   3              		.fpu fpv5-d16
   4              		.eabi_attribute 28, 1
   5              		.eabi_attribute 20, 1
   6              		.eabi_attribute 21, 1
   7              		.eabi_attribute 23, 3
   8              		.eabi_attribute 24, 1
   9              		.eabi_attribute 25, 1
  10              		.eabi_attribute 26, 1
  11              		.eabi_attribute 30, 1
  12              		.eabi_attribute 34, 1
  13              		.eabi_attribute 18, 4
  14              		.file	"loadcell.c"
  15              		.text
  16              	.Ltext0:
  17              		.cfi_sections	.debug_frame
  18              		.file 1 "../../mod/loadcell/loadcell.c"
  19              		.section	.text.poll_loadcell_adc,"ax",%progbits
  20              		.align	1
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  25              	poll_loadcell_adc:
  26              	.LVL0:
  27              	.LFB334:
   1:../../mod/loadcell/loadcell.c **** /*******************************************************************************
   2:../../mod/loadcell/loadcell.c **** *
   3:../../mod/loadcell/loadcell.c **** * FILE: 
   4:../../mod/loadcell/loadcell.c **** * 		loadcell.c
   5:../../mod/loadcell/loadcell.c **** *
   6:../../mod/loadcell/loadcell.c **** * DESCRIPTION: 
   7:../../mod/loadcell/loadcell.c **** * 		Contains API functions for reading data from the engine's load cell 
   8:../../mod/loadcell/loadcell.c **** *
   9:../../mod/loadcell/loadcell.c **** *******************************************************************************/
  10:../../mod/loadcell/loadcell.c **** 
  11:../../mod/loadcell/loadcell.c **** 
  12:../../mod/loadcell/loadcell.c **** /*------------------------------------------------------------------------------
  13:../../mod/loadcell/loadcell.c ****  Standard Includes                                                                     
  14:../../mod/loadcell/loadcell.c **** ------------------------------------------------------------------------------*/
  15:../../mod/loadcell/loadcell.c **** 
  16:../../mod/loadcell/loadcell.c **** 
  17:../../mod/loadcell/loadcell.c **** /*------------------------------------------------------------------------------
  18:../../mod/loadcell/loadcell.c ****  Project Includes                                                                     
  19:../../mod/loadcell/loadcell.c **** ------------------------------------------------------------------------------*/
  20:../../mod/loadcell/loadcell.c **** #include "main.h"
  21:../../mod/loadcell/loadcell.c **** #include "sdr_pin_defines_L0002.h"
  22:../../mod/loadcell/loadcell.c **** #include "loadcell.h"
  23:../../mod/loadcell/loadcell.c **** 
  24:../../mod/loadcell/loadcell.c **** /*------------------------------------------------------------------------------
  25:../../mod/loadcell/loadcell.c ****  Global Variables 
  26:../../mod/loadcell/loadcell.c **** ------------------------------------------------------------------------------*/
  27:../../mod/loadcell/loadcell.c **** 
  28:../../mod/loadcell/loadcell.c **** 
  29:../../mod/loadcell/loadcell.c **** /*------------------------------------------------------------------------------
  30:../../mod/loadcell/loadcell.c ****  Internal function prototypes 
  31:../../mod/loadcell/loadcell.c **** ------------------------------------------------------------------------------*/
ARM GAS  /tmp/ccv5mkc5.s 			page 2


  32:../../mod/loadcell/loadcell.c **** 
  33:../../mod/loadcell/loadcell.c **** /* Sample the load cell ADC a specified number of times in polling mode */
  34:../../mod/loadcell/loadcell.c **** static LOADCELL_STATUS poll_loadcell_adc 
  35:../../mod/loadcell/loadcell.c **** 	(
  36:../../mod/loadcell/loadcell.c ****     uint16_t    num_samples,
  37:../../mod/loadcell/loadcell.c ****     uint32_t*   psample_buffer
  38:../../mod/loadcell/loadcell.c ****     );
  39:../../mod/loadcell/loadcell.c **** 
  40:../../mod/loadcell/loadcell.c **** /*------------------------------------------------------------------------------
  41:../../mod/loadcell/loadcell.c ****  API Functions 
  42:../../mod/loadcell/loadcell.c **** ------------------------------------------------------------------------------*/
  43:../../mod/loadcell/loadcell.c **** 
  44:../../mod/loadcell/loadcell.c **** 
  45:../../mod/loadcell/loadcell.c **** /*******************************************************************************
  46:../../mod/loadcell/loadcell.c **** *                                                                              *
  47:../../mod/loadcell/loadcell.c **** * PROCEDURE:                                                                   * 
  48:../../mod/loadcell/loadcell.c **** * 		loadcell_get_reading                                                   *
  49:../../mod/loadcell/loadcell.c **** *                                                                              *
  50:../../mod/loadcell/loadcell.c **** * DESCRIPTION:                                                                 * 
  51:../../mod/loadcell/loadcell.c **** *       Read the load cell force                                               *
  52:../../mod/loadcell/loadcell.c **** *                                                                              *
  53:../../mod/loadcell/loadcell.c **** *******************************************************************************/
  54:../../mod/loadcell/loadcell.c **** uint32_t loadcell_get_reading 
  55:../../mod/loadcell/loadcell.c **** 	(
  56:../../mod/loadcell/loadcell.c **** 	void
  57:../../mod/loadcell/loadcell.c ****     )
  58:../../mod/loadcell/loadcell.c **** {
  59:../../mod/loadcell/loadcell.c **** /*------------------------------------------------------------------------------
  60:../../mod/loadcell/loadcell.c ****  Local Variables  
  61:../../mod/loadcell/loadcell.c **** ------------------------------------------------------------------------------*/
  62:../../mod/loadcell/loadcell.c **** LOADCELL_STATUS loadcell_status; /* Return code from ADC operation */ 
  63:../../mod/loadcell/loadcell.c **** uint32_t        loadcell_reading; /* Readout from loadcell ADC */
  64:../../mod/loadcell/loadcell.c **** 
  65:../../mod/loadcell/loadcell.c **** 
  66:../../mod/loadcell/loadcell.c **** /*------------------------------------------------------------------------------
  67:../../mod/loadcell/loadcell.c ****  Initializations 
  68:../../mod/loadcell/loadcell.c **** ------------------------------------------------------------------------------*/
  69:../../mod/loadcell/loadcell.c **** loadcell_status  = LOADCELL_OK;
  70:../../mod/loadcell/loadcell.c **** loadcell_reading = 0;
  71:../../mod/loadcell/loadcell.c **** 
  72:../../mod/loadcell/loadcell.c **** 
  73:../../mod/loadcell/loadcell.c **** /*------------------------------------------------------------------------------
  74:../../mod/loadcell/loadcell.c ****  Poll ADC once 
  75:../../mod/loadcell/loadcell.c **** ------------------------------------------------------------------------------*/
  76:../../mod/loadcell/loadcell.c **** loadcell_status = poll_loadcell_adc( 1, &loadcell_reading );
  77:../../mod/loadcell/loadcell.c **** if ( loadcell_status != LOADCELL_OK )
  78:../../mod/loadcell/loadcell.c **** 	{
  79:../../mod/loadcell/loadcell.c ****     Error_Handler();
  80:../../mod/loadcell/loadcell.c ****     }
  81:../../mod/loadcell/loadcell.c **** return loadcell_reading;
  82:../../mod/loadcell/loadcell.c **** 
  83:../../mod/loadcell/loadcell.c **** } /* loadcell_get_reading */
  84:../../mod/loadcell/loadcell.c **** 
  85:../../mod/loadcell/loadcell.c **** 
  86:../../mod/loadcell/loadcell.c **** /*------------------------------------------------------------------------------
  87:../../mod/loadcell/loadcell.c ****  Internal procedures 
  88:../../mod/loadcell/loadcell.c **** ------------------------------------------------------------------------------*/
ARM GAS  /tmp/ccv5mkc5.s 			page 3


  89:../../mod/loadcell/loadcell.c **** 
  90:../../mod/loadcell/loadcell.c **** 
  91:../../mod/loadcell/loadcell.c **** /*******************************************************************************
  92:../../mod/loadcell/loadcell.c **** *                                                                              *
  93:../../mod/loadcell/loadcell.c **** * PROCEDURE:                                                                   * 
  94:../../mod/loadcell/loadcell.c **** * 		poll_loadcell_adc                                                      *
  95:../../mod/loadcell/loadcell.c **** *                                                                              *
  96:../../mod/loadcell/loadcell.c **** * DESCRIPTION:                                                                 * 
  97:../../mod/loadcell/loadcell.c **** *       Sample the load cell ADC a specified number of times in polling mode   *
  98:../../mod/loadcell/loadcell.c **** *                                                                              *
  99:../../mod/loadcell/loadcell.c **** *******************************************************************************/
 100:../../mod/loadcell/loadcell.c **** static LOADCELL_STATUS poll_loadcell_adc 
 101:../../mod/loadcell/loadcell.c **** 	(
 102:../../mod/loadcell/loadcell.c ****     uint16_t    num_samples,
 103:../../mod/loadcell/loadcell.c ****     uint32_t*   psample_buffer
 104:../../mod/loadcell/loadcell.c ****     )
 105:../../mod/loadcell/loadcell.c **** {
  28              		.loc 1 105 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		.loc 1 105 1 is_stmt 0 view .LVU1
  33 0000 70B5     		push	{r4, r5, r6, lr}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 16
  36              		.cfi_offset 4, -16
  37              		.cfi_offset 5, -12
  38              		.cfi_offset 6, -8
  39              		.cfi_offset 14, -4
  40 0002 0546     		mov	r5, r0
  41 0004 0E46     		mov	r6, r1
 106:../../mod/loadcell/loadcell.c **** /* Conversion status indicator */
 107:../../mod/loadcell/loadcell.c **** HAL_StatusTypeDef adc_status;
  42              		.loc 1 107 1 is_stmt 1 view .LVU2
 108:../../mod/loadcell/loadcell.c **** 
 109:../../mod/loadcell/loadcell.c **** /* Start the ADC */
 110:../../mod/loadcell/loadcell.c **** HAL_ADC_Start( &( LOADCELL_ADC ) );
  43              		.loc 1 110 1 view .LVU3
  44 0006 0F48     		ldr	r0, .L10
  45              	.LVL1:
  46              		.loc 1 110 1 is_stmt 0 view .LVU4
  47 0008 FFF7FEFF 		bl	HAL_ADC_Start
  48              	.LVL2:
 111:../../mod/loadcell/loadcell.c **** 
 112:../../mod/loadcell/loadcell.c **** /* Poll ADC */
 113:../../mod/loadcell/loadcell.c **** for ( int i = 0; i < num_samples; ++i )
  49              		.loc 1 113 1 is_stmt 1 view .LVU5
  50              	.LBB2:
  51              		.loc 1 113 7 view .LVU6
  52              		.loc 1 113 11 is_stmt 0 view .LVU7
  53 000c 0024     		movs	r4, #0
  54              		.loc 1 113 1 view .LVU8
  55 000e 05E0     		b	.L2
  56              	.LVL3:
  57              	.L9:
 114:../../mod/loadcell/loadcell.c **** 	{
 115:../../mod/loadcell/loadcell.c **** 	/* Wait for end of conversion */
ARM GAS  /tmp/ccv5mkc5.s 			page 4


 116:../../mod/loadcell/loadcell.c ****     adc_status = HAL_ADC_PollForConversion( &( LOADCELL_ADC ), 
 117:../../mod/loadcell/loadcell.c **** 	                                        LOADCELL_ADC_HAL_TIMEOUT );
 118:../../mod/loadcell/loadcell.c ****     if      ( adc_status == HAL_TIMEOUT )
 119:../../mod/loadcell/loadcell.c **** 		{
 120:../../mod/loadcell/loadcell.c ****         return LOADCELL_ADC_TIMEOUT;
 121:../../mod/loadcell/loadcell.c ****         }
 122:../../mod/loadcell/loadcell.c **** 	else if ( adc_status != HAL_OK      )
 123:../../mod/loadcell/loadcell.c **** 		{
 124:../../mod/loadcell/loadcell.c ****         return LOADCELL_ADC_POLL_ERROR;
 125:../../mod/loadcell/loadcell.c ****         }
 126:../../mod/loadcell/loadcell.c **** 	else /* No error */
 127:../../mod/loadcell/loadcell.c **** 		{
 128:../../mod/loadcell/loadcell.c **** 		/* Read the ADC value */
 129:../../mod/loadcell/loadcell.c **** 		*(psample_buffer + i) = HAL_ADC_GetValue( &( LOADCELL_ADC ) ); 
  58              		.loc 1 129 3 is_stmt 1 discriminator 2 view .LVU9
  59              		.loc 1 129 27 is_stmt 0 discriminator 2 view .LVU10
  60 0010 0C48     		ldr	r0, .L10
  61              	.LVL4:
  62              		.loc 1 129 27 discriminator 2 view .LVU11
  63 0012 FFF7FEFF 		bl	HAL_ADC_GetValue
  64              	.LVL5:
  65              		.loc 1 129 25 discriminator 2 view .LVU12
  66 0016 46F82400 		str	r0, [r6, r4, lsl #2]
 113:../../mod/loadcell/loadcell.c **** 	{
  67              		.loc 1 113 35 is_stmt 1 discriminator 2 view .LVU13
  68 001a 0134     		adds	r4, r4, #1
  69              	.LVL6:
  70              	.L2:
 113:../../mod/loadcell/loadcell.c **** 	{
  71              		.loc 1 113 20 discriminator 1 view .LVU14
  72 001c A542     		cmp	r5, r4
  73 001e 09DD     		ble	.L8
 116:../../mod/loadcell/loadcell.c **** 	                                        LOADCELL_ADC_HAL_TIMEOUT );
  74              		.loc 1 116 5 view .LVU15
 116:../../mod/loadcell/loadcell.c **** 	                                        LOADCELL_ADC_HAL_TIMEOUT );
  75              		.loc 1 116 18 is_stmt 0 view .LVU16
  76 0020 6421     		movs	r1, #100
  77 0022 0848     		ldr	r0, .L10
  78 0024 FFF7FEFF 		bl	HAL_ADC_PollForConversion
  79              	.LVL7:
 118:../../mod/loadcell/loadcell.c **** 		{
  80              		.loc 1 118 5 is_stmt 1 view .LVU17
 118:../../mod/loadcell/loadcell.c **** 		{
  81              		.loc 1 118 13 is_stmt 0 view .LVU18
  82 0028 0328     		cmp	r0, #3
  83 002a 08D0     		beq	.L5
 122:../../mod/loadcell/loadcell.c **** 		{
  84              		.loc 1 122 7 is_stmt 1 view .LVU19
 122:../../mod/loadcell/loadcell.c **** 		{
  85              		.loc 1 122 10 is_stmt 0 view .LVU20
  86 002c 0028     		cmp	r0, #0
  87 002e EFD0     		beq	.L9
 124:../../mod/loadcell/loadcell.c ****         }
  88              		.loc 1 124 16 view .LVU21
  89 0030 0220     		movs	r0, #2
  90              	.LVL8:
 124:../../mod/loadcell/loadcell.c ****         }
ARM GAS  /tmp/ccv5mkc5.s 			page 5


  91              		.loc 1 124 16 view .LVU22
  92 0032 03E0     		b	.L3
  93              	.LVL9:
  94              	.L8:
 124:../../mod/loadcell/loadcell.c ****         }
  95              		.loc 1 124 16 view .LVU23
  96              	.LBE2:
 130:../../mod/loadcell/loadcell.c ****         }
 131:../../mod/loadcell/loadcell.c ****     }
 132:../../mod/loadcell/loadcell.c **** 
 133:../../mod/loadcell/loadcell.c **** /* Stop the ADC */
 134:../../mod/loadcell/loadcell.c **** HAL_ADC_Stop( &( LOADCELL_ADC ) );
  97              		.loc 1 134 1 is_stmt 1 view .LVU24
  98 0034 0348     		ldr	r0, .L10
  99 0036 FFF7FEFF 		bl	HAL_ADC_Stop
 100              	.LVL10:
 135:../../mod/loadcell/loadcell.c **** 
 136:../../mod/loadcell/loadcell.c **** /* Conversion successful */
 137:../../mod/loadcell/loadcell.c **** return LOADCELL_OK;
 101              		.loc 1 137 1 view .LVU25
 102              		.loc 1 137 8 is_stmt 0 view .LVU26
 103 003a 0020     		movs	r0, #0
 104              	.L3:
 138:../../mod/loadcell/loadcell.c **** 
 139:../../mod/loadcell/loadcell.c **** } /* poll_load_cell_adc */
 105              		.loc 1 139 1 view .LVU27
 106 003c 70BD     		pop	{r4, r5, r6, pc}
 107              	.LVL11:
 108              	.L5:
 109              	.LBB3:
 120:../../mod/loadcell/loadcell.c ****         }
 110              		.loc 1 120 16 view .LVU28
 111 003e 0120     		movs	r0, #1
 112              	.LVL12:
 120:../../mod/loadcell/loadcell.c ****         }
 113              		.loc 1 120 16 view .LVU29
 114 0040 FCE7     		b	.L3
 115              	.L11:
 116 0042 00BF     		.align	2
 117              	.L10:
 118 0044 00000000 		.word	hadc2
 119              	.LBE3:
 120              		.cfi_endproc
 121              	.LFE334:
 123              		.section	.text.loadcell_get_reading,"ax",%progbits
 124              		.align	1
 125              		.global	loadcell_get_reading
 126              		.syntax unified
 127              		.thumb
 128              		.thumb_func
 130              	loadcell_get_reading:
 131              	.LFB333:
  58:../../mod/loadcell/loadcell.c **** /*------------------------------------------------------------------------------
 132              		.loc 1 58 1 is_stmt 1 view -0
 133              		.cfi_startproc
 134              		@ args = 0, pretend = 0, frame = 8
 135              		@ frame_needed = 0, uses_anonymous_args = 0
ARM GAS  /tmp/ccv5mkc5.s 			page 6


 136 0000 00B5     		push	{lr}
 137              	.LCFI1:
 138              		.cfi_def_cfa_offset 4
 139              		.cfi_offset 14, -4
 140 0002 83B0     		sub	sp, sp, #12
 141              	.LCFI2:
 142              		.cfi_def_cfa_offset 16
  62:../../mod/loadcell/loadcell.c **** uint32_t        loadcell_reading; /* Readout from loadcell ADC */
 143              		.loc 1 62 1 view .LVU31
  63:../../mod/loadcell/loadcell.c **** 
 144              		.loc 1 63 1 view .LVU32
  69:../../mod/loadcell/loadcell.c **** loadcell_reading = 0;
 145              		.loc 1 69 1 view .LVU33
 146              	.LVL13:
  70:../../mod/loadcell/loadcell.c **** 
 147              		.loc 1 70 1 view .LVU34
  70:../../mod/loadcell/loadcell.c **** 
 148              		.loc 1 70 18 is_stmt 0 view .LVU35
 149 0004 0023     		movs	r3, #0
 150 0006 0193     		str	r3, [sp, #4]
  76:../../mod/loadcell/loadcell.c **** if ( loadcell_status != LOADCELL_OK )
 151              		.loc 1 76 1 is_stmt 1 view .LVU36
  76:../../mod/loadcell/loadcell.c **** if ( loadcell_status != LOADCELL_OK )
 152              		.loc 1 76 19 is_stmt 0 view .LVU37
 153 0008 01A9     		add	r1, sp, #4
 154 000a 0120     		movs	r0, #1
 155 000c FFF7FEFF 		bl	poll_loadcell_adc
 156              	.LVL14:
  77:../../mod/loadcell/loadcell.c **** 	{
 157              		.loc 1 77 1 is_stmt 1 view .LVU38
  77:../../mod/loadcell/loadcell.c **** 	{
 158              		.loc 1 77 4 is_stmt 0 view .LVU39
 159 0010 18B9     		cbnz	r0, .L15
 160              	.LVL15:
 161              	.L13:
  81:../../mod/loadcell/loadcell.c **** 
 162              		.loc 1 81 1 is_stmt 1 view .LVU40
  83:../../mod/loadcell/loadcell.c **** 
 163              		.loc 1 83 1 is_stmt 0 view .LVU41
 164 0012 0198     		ldr	r0, [sp, #4]
 165 0014 03B0     		add	sp, sp, #12
 166              	.LCFI3:
 167              		.cfi_remember_state
 168              		.cfi_def_cfa_offset 4
 169              		@ sp needed
 170 0016 5DF804FB 		ldr	pc, [sp], #4
 171              	.LVL16:
 172              	.L15:
 173              	.LCFI4:
 174              		.cfi_restore_state
 175              	.LBB4:
  79:../../mod/loadcell/loadcell.c ****     }
 176              		.loc 1 79 5 is_stmt 1 view .LVU42
 177 001a FFF7FEFF 		bl	Error_Handler
 178              	.LVL17:
  79:../../mod/loadcell/loadcell.c ****     }
 179              		.loc 1 79 5 is_stmt 0 view .LVU43
ARM GAS  /tmp/ccv5mkc5.s 			page 7


 180 001e F8E7     		b	.L13
 181              	.LBE4:
 182              		.cfi_endproc
 183              	.LFE333:
 185              		.text
 186              	.Letext0:
 187              		.file 2 "/usr/arm-none-eabi/include/machine/_default_types.h"
 188              		.file 3 "/usr/arm-none-eabi/include/sys/_stdint.h"
 189              		.file 4 "../../lib/Drivers/CMSIS/Device/ST/STM32H7xx/Include/stm32h750xx.h"
 190              		.file 5 "../../lib/Drivers/CMSIS/Device/ST/STM32H7xx/Include/stm32h7xx.h"
 191              		.file 6 "../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_def.h"
 192              		.file 7 "../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_dma.h"
 193              		.file 8 "../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_adc.h"
 194              		.file 9 "../../mod/loadcell/loadcell.h"
 195              		.file 10 "../../lib/sdr_pin_defines_L0002.h"
ARM GAS  /tmp/ccv5mkc5.s 			page 8


DEFINED SYMBOLS
                            *ABS*:0000000000000000 loadcell.c
     /tmp/ccv5mkc5.s:20     .text.poll_loadcell_adc:0000000000000000 $t
     /tmp/ccv5mkc5.s:25     .text.poll_loadcell_adc:0000000000000000 poll_loadcell_adc
     /tmp/ccv5mkc5.s:118    .text.poll_loadcell_adc:0000000000000044 $d
     /tmp/ccv5mkc5.s:124    .text.loadcell_get_reading:0000000000000000 $t
     /tmp/ccv5mkc5.s:130    .text.loadcell_get_reading:0000000000000000 loadcell_get_reading

UNDEFINED SYMBOLS
HAL_ADC_Start
HAL_ADC_GetValue
HAL_ADC_PollForConversion
HAL_ADC_Stop
hadc2
Error_Handler
