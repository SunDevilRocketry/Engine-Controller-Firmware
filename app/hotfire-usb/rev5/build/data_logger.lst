ARM GAS  /tmp/ccKqyHz1.s 			page 1


   1              		.cpu cortex-m7
   2              		.arch armv7e-m
   3              		.fpu fpv5-d16
   4              		.eabi_attribute 28, 1
   5              		.eabi_attribute 20, 1
   6              		.eabi_attribute 21, 1
   7              		.eabi_attribute 23, 3
   8              		.eabi_attribute 24, 1
   9              		.eabi_attribute 25, 1
  10              		.eabi_attribute 26, 1
  11              		.eabi_attribute 30, 1
  12              		.eabi_attribute 34, 1
  13              		.eabi_attribute 18, 4
  14              		.file	"data_logger.c"
  15              		.text
  16              	.Ltext0:
  17              		.cfi_sections	.debug_frame
  18              		.file 1 "data_logger.c"
  19              		.section	.text.data_logger_init_timer,"ax",%progbits
  20              		.align	1
  21              		.global	data_logger_init_timer
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  26              	data_logger_init_timer:
  27              	.LFB333:
   1:data_logger.c **** /*******************************************************************************
   2:data_logger.c **** *
   3:data_logger.c **** * FILE: 
   4:data_logger.c **** * 		data_logger.c
   5:data_logger.c **** *
   6:data_logger.c **** * DESCRIPTION: 
   7:data_logger.c **** * 	    Contains procedures for logging data onto the engine controller's 
   8:data_logger.c **** *       external flash chip	
   9:data_logger.c **** *
  10:data_logger.c **** *******************************************************************************/
  11:data_logger.c **** 
  12:data_logger.c **** /*------------------------------------------------------------------------------
  13:data_logger.c ****  Standard Includes                                                              
  14:data_logger.c **** ------------------------------------------------------------------------------*/
  15:data_logger.c **** #include <string.h>
  16:data_logger.c **** 
  17:data_logger.c **** 
  18:data_logger.c **** /*------------------------------------------------------------------------------
  19:data_logger.c ****  Project Includes                                                               
  20:data_logger.c **** ------------------------------------------------------------------------------*/
  21:data_logger.c **** #include "data_logger.h"
  22:data_logger.c **** #include "flash.h"
  23:data_logger.c **** 
  24:data_logger.c **** 
  25:data_logger.c **** /*------------------------------------------------------------------------------
  26:data_logger.c ****  Global Variables 
  27:data_logger.c **** ------------------------------------------------------------------------------*/
  28:data_logger.c **** 
  29:data_logger.c **** /* Flash address to use for logging flight data */
  30:data_logger.c **** static uint32_t     data_logger_addr       = 0;
  31:data_logger.c **** static uint32_t     data_logger_rel_addr   = 0;
ARM GAS  /tmp/ccKqyHz1.s 			page 2


  32:data_logger.c **** 
  33:data_logger.c **** /* Timer */
  34:data_logger.c **** static uint32_t     data_logger_start_time = 0; 
  35:data_logger.c **** 
  36:data_logger.c **** /*------------------------------------------------------------------------------
  37:data_logger.c ****  Procedures 
  38:data_logger.c **** ------------------------------------------------------------------------------*/
  39:data_logger.c **** 
  40:data_logger.c **** /*******************************************************************************
  41:data_logger.c **** *                                                                              *
  42:data_logger.c **** * PROCEDURE:                                                                   *
  43:data_logger.c **** * 		data_logger_init_timer                                                 *
  44:data_logger.c **** *                                                                              *
  45:data_logger.c **** * DESCRIPTION:                                                                 *
  46:data_logger.c **** * 		Initialize the data logger timer                                       *
  47:data_logger.c **** *                                                                              *
  48:data_logger.c **** *******************************************************************************/
  49:data_logger.c **** void data_logger_init_timer
  50:data_logger.c ****     (
  51:data_logger.c ****     void
  52:data_logger.c ****     )
  53:data_logger.c **** {
  28              		.loc 1 53 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32 0000 08B5     		push	{r3, lr}
  33              	.LCFI0:
  34              		.cfi_def_cfa_offset 8
  35              		.cfi_offset 3, -8
  36              		.cfi_offset 14, -4
  54:data_logger.c **** data_logger_start_time = HAL_GetTick();
  37              		.loc 1 54 1 view .LVU1
  38              		.loc 1 54 26 is_stmt 0 view .LVU2
  39 0002 FFF7FEFF 		bl	HAL_GetTick
  40              	.LVL0:
  41              		.loc 1 54 24 view .LVU3
  42 0006 014B     		ldr	r3, .L3
  43 0008 1860     		str	r0, [r3]
  55:data_logger.c **** } /* data_logger_init_timer */
  44              		.loc 1 55 1 view .LVU4
  45 000a 08BD     		pop	{r3, pc}
  46              	.L4:
  47              		.align	2
  48              	.L3:
  49 000c 00000000 		.word	data_logger_start_time
  50              		.cfi_endproc
  51              	.LFE333:
  53              		.section	.text.data_logger_log_data,"ax",%progbits
  54              		.align	1
  55              		.global	data_logger_log_data
  56              		.syntax unified
  57              		.thumb
  58              		.thumb_func
  60              	data_logger_log_data:
  61              	.LFB334:
  56:data_logger.c **** 
ARM GAS  /tmp/ccKqyHz1.s 			page 3


  57:data_logger.c **** 
  58:data_logger.c **** /*******************************************************************************
  59:data_logger.c **** *                                                                              *
  60:data_logger.c **** * PROCEDURE:                                                                   *
  61:data_logger.c **** * 		data_logger_log_data                                                   *
  62:data_logger.c **** *                                                                              *
  63:data_logger.c **** * DESCRIPTION:                                                                 *
  64:data_logger.c **** *       Writes sensor data in flash using the flash header                     *
  65:data_logger.c **** *                                                                              *
  66:data_logger.c **** *******************************************************************************/
  67:data_logger.c **** DATA_LOG_STATUS data_logger_log_data
  68:data_logger.c ****     (
  69:data_logger.c ****     DATA_LOG_DATA_FRAME data_frame /* data to be logged to flash */
  70:data_logger.c ****     )
  71:data_logger.c **** {
  62              		.loc 1 71 1 is_stmt 1 view -0
  63              		.cfi_startproc
  64              		@ args = 44, pretend = 16, frame = 64
  65              		@ frame_needed = 0, uses_anonymous_args = 0
  66 0000 84B0     		sub	sp, sp, #16
  67              	.LCFI1:
  68              		.cfi_def_cfa_offset 16
  69 0002 00B5     		push	{lr}
  70              	.LCFI2:
  71              		.cfi_def_cfa_offset 20
  72              		.cfi_offset 14, -20
  73 0004 91B0     		sub	sp, sp, #68
  74              	.LCFI3:
  75              		.cfi_def_cfa_offset 88
  76 0006 0DF1480C 		add	ip, sp, #72
  77 000a 8CE80F00 		stm	ip, {r0, r1, r2, r3}
  72:data_logger.c **** /*------------------------------------------------------------------------------
  73:data_logger.c ****  Local variables 
  74:data_logger.c **** ------------------------------------------------------------------------------*/
  75:data_logger.c **** FLASH_STATUS  flash_status;                 /* Flash API return codes         */
  78              		.loc 1 75 1 view .LVU6
  76:data_logger.c **** HFLASH_BUFFER flash_handle;                 /* Flash API struct               */
  79              		.loc 1 76 1 view .LVU7
  77:data_logger.c **** uint8_t       flash_buffer[ sizeof( DATA_LOG_DATA_FRAME ) ]; /* Buffer to be 
  80              		.loc 1 77 1 view .LVU8
  78:data_logger.c ****                                                             read by flash API */
  79:data_logger.c **** 
  80:data_logger.c **** 
  81:data_logger.c **** /*------------------------------------------------------------------------------
  82:data_logger.c ****  Initializations 
  83:data_logger.c **** ------------------------------------------------------------------------------*/
  84:data_logger.c **** flash_status = FLASH_OK;
  81              		.loc 1 84 1 view .LVU9
  82              	.LVL1:
  85:data_logger.c **** memcpy( &flash_buffer[0], &data_frame, sizeof( DATA_LOG_DATA_FRAME ) );
  83              		.loc 1 85 1 view .LVU10
  84 000e 0DF1040C 		add	ip, sp, #4
  85 0012 0DF1480E 		add	lr, sp, #72
  86 0016 BEE80F00 		ldmia	lr!, {r0, r1, r2, r3}
  87 001a ACE80F00 		stmia	ip!, {r0, r1, r2, r3}
  88 001e BEE80F00 		ldmia	lr!, {r0, r1, r2, r3}
  89 0022 ACE80F00 		stmia	ip!, {r0, r1, r2, r3}
ARM GAS  /tmp/ccKqyHz1.s 			page 4


  90 0026 9EE80700 		ldm	lr, {r0, r1, r2}
  91 002a 8CE80700 		stm	ip, {r0, r1, r2}
  86:data_logger.c **** 
  87:data_logger.c **** /* Flash write setup */
  88:data_logger.c **** flash_handle.pbuffer   = &flash_buffer[0];
  92              		.loc 1 88 1 view .LVU11
  93              		.loc 1 88 24 is_stmt 0 view .LVU12
  94 002e 01AB     		add	r3, sp, #4
  95 0030 0E93     		str	r3, [sp, #56]
  89:data_logger.c **** flash_handle.address   = data_logger_addr;
  96              		.loc 1 89 1 is_stmt 1 view .LVU13
  97              		.loc 1 89 24 is_stmt 0 view .LVU14
  98 0032 114B     		ldr	r3, .L11
  99 0034 1B68     		ldr	r3, [r3]
 100 0036 0D93     		str	r3, [sp, #52]
  90:data_logger.c **** flash_handle.num_bytes = sizeof( DATA_LOG_DATA_FRAME );
 101              		.loc 1 90 1 is_stmt 1 view .LVU15
 102              		.loc 1 90 24 is_stmt 0 view .LVU16
 103 0038 2C22     		movs	r2, #44
 104 003a 0C92     		str	r2, [sp, #48]
  91:data_logger.c **** 
  92:data_logger.c **** 
  93:data_logger.c **** /*------------------------------------------------------------------------------
  94:data_logger.c ****  Implementation 
  95:data_logger.c **** ------------------------------------------------------------------------------*/
  96:data_logger.c **** 
  97:data_logger.c **** /* Out of memory check */
  98:data_logger.c **** if ( ( data_logger_addr + sizeof( DATA_LOG_DATA_FRAME ) ) > FLASH_MAX_ADDR )
 105              		.loc 1 98 1 is_stmt 1 view .LVU17
 106              		.loc 1 98 25 is_stmt 0 view .LVU18
 107 003c 1344     		add	r3, r3, r2
 108              		.loc 1 98 4 view .LVU19
 109 003e B3F5002F 		cmp	r3, #524288
 110 0042 14D2     		bcs	.L8
 111              	.L7:
  99:data_logger.c ****     {
 100:data_logger.c ****     return DATA_LOG_OUT_OF_MEMORY;
 101:data_logger.c ****     }
 102:data_logger.c **** 
 103:data_logger.c **** /* Write the data to flash */
 104:data_logger.c **** while( flash_is_flash_busy() == FLASH_BUSY ){};
 112              		.loc 1 104 46 is_stmt 1 discriminator 1 view .LVU20
 113              		.loc 1 104 30 discriminator 1 view .LVU21
 114              		.loc 1 104 8 is_stmt 0 discriminator 1 view .LVU22
 115 0044 FFF7FEFF 		bl	flash_is_flash_busy
 116              	.LVL2:
 117              		.loc 1 104 30 discriminator 1 view .LVU23
 118 0048 0028     		cmp	r0, #0
 119 004a FBD1     		bne	.L7
 120              		.loc 1 104 47 is_stmt 1 discriminator 2 view .LVU24
 105:data_logger.c **** flash_status = flash_write( &flash_handle );
 121              		.loc 1 105 1 discriminator 2 view .LVU25
 122              		.loc 1 105 16 is_stmt 0 discriminator 2 view .LVU26
 123 004c 0CA8     		add	r0, sp, #48
 124 004e FFF7FEFF 		bl	flash_write
 125              	.LVL3:
 106:data_logger.c **** if ( flash_status != FLASH_OK )
ARM GAS  /tmp/ccKqyHz1.s 			page 5


 126              		.loc 1 106 1 is_stmt 1 discriminator 2 view .LVU27
 127              		.loc 1 106 4 is_stmt 0 discriminator 2 view .LVU28
 128 0052 70B9     		cbnz	r0, .L9
 107:data_logger.c ****     {
 108:data_logger.c ****     return DATA_LOG_FLASH_ERROR;
 109:data_logger.c ****     }
 110:data_logger.c **** 
 111:data_logger.c **** /* Update data logger addresses */
 112:data_logger.c **** data_logger_addr     += sizeof( DATA_LOG_DATA_FRAME );
 129              		.loc 1 112 1 is_stmt 1 view .LVU29
 130              		.loc 1 112 22 is_stmt 0 view .LVU30
 131 0054 084A     		ldr	r2, .L11
 132 0056 1368     		ldr	r3, [r2]
 133 0058 2C33     		adds	r3, r3, #44
 134 005a 1360     		str	r3, [r2]
 113:data_logger.c **** data_logger_rel_addr += sizeof( DATA_LOG_DATA_FRAME );
 135              		.loc 1 113 1 is_stmt 1 view .LVU31
 136              		.loc 1 113 22 is_stmt 0 view .LVU32
 137 005c 074A     		ldr	r2, .L11+4
 138 005e 1368     		ldr	r3, [r2]
 139 0060 2C33     		adds	r3, r3, #44
 140 0062 1360     		str	r3, [r2]
 114:data_logger.c **** return DATA_LOG_OK;
 141              		.loc 1 114 1 is_stmt 1 view .LVU33
 142              	.LVL4:
 143              	.L6:
 115:data_logger.c **** } /* data_logger_log_data */
 144              		.loc 1 115 1 is_stmt 0 view .LVU34
 145 0064 11B0     		add	sp, sp, #68
 146              	.LCFI4:
 147              		.cfi_remember_state
 148              		.cfi_def_cfa_offset 20
 149              		@ sp needed
 150 0066 5DF804EB 		ldr	lr, [sp], #4
 151              	.LCFI5:
 152              		.cfi_restore 14
 153              		.cfi_def_cfa_offset 16
 154 006a 04B0     		add	sp, sp, #16
 155              	.LCFI6:
 156              		.cfi_def_cfa_offset 0
 157 006c 7047     		bx	lr
 158              	.LVL5:
 159              	.L8:
 160              	.LCFI7:
 161              		.cfi_restore_state
 100:data_logger.c ****     }
 162              		.loc 1 100 12 view .LVU35
 163 006e 0120     		movs	r0, #1
 164 0070 F8E7     		b	.L6
 165              	.LVL6:
 166              	.L9:
 108:data_logger.c ****     }
 167              		.loc 1 108 12 view .LVU36
 168 0072 0220     		movs	r0, #2
 169              	.LVL7:
 108:data_logger.c ****     }
 170              		.loc 1 108 12 view .LVU37
ARM GAS  /tmp/ccKqyHz1.s 			page 6


 171 0074 F6E7     		b	.L6
 172              	.L12:
 173 0076 00BF     		.align	2
 174              	.L11:
 175 0078 00000000 		.word	data_logger_addr
 176 007c 00000000 		.word	data_logger_rel_addr
 177              		.cfi_endproc
 178              	.LFE334:
 180              		.section	.text.data_logger_get_data,"ax",%progbits
 181              		.align	1
 182              		.global	data_logger_get_data
 183              		.syntax unified
 184              		.thumb
 185              		.thumb_func
 187              	data_logger_get_data:
 188              	.LVL8:
 189              	.LFB335:
 116:data_logger.c **** 
 117:data_logger.c **** 
 118:data_logger.c **** /*******************************************************************************
 119:data_logger.c **** *                                                                              *
 120:data_logger.c **** * PROCEDURE:                                                                   *
 121:data_logger.c **** * 		data_logger_get_data                                                   *
 122:data_logger.c **** *                                                                              *
 123:data_logger.c **** * DESCRIPTION:                                                                 *
 124:data_logger.c **** *       Acquires a frame of data from sensors and timers                       *
 125:data_logger.c **** *                                                                              *
 126:data_logger.c **** *******************************************************************************/
 127:data_logger.c **** DATA_LOG_STATUS data_logger_get_data
 128:data_logger.c ****     (
 129:data_logger.c ****     DATA_LOG_DATA_FRAME* data_ptr
 130:data_logger.c ****     )
 131:data_logger.c **** {
 190              		.loc 1 131 1 is_stmt 1 view -0
 191              		.cfi_startproc
 192              		@ args = 0, pretend = 0, frame = 40
 193              		@ frame_needed = 0, uses_anonymous_args = 0
 194              		.loc 1 131 1 is_stmt 0 view .LVU39
 195 0000 30B5     		push	{r4, r5, lr}
 196              	.LCFI8:
 197              		.cfi_def_cfa_offset 12
 198              		.cfi_offset 4, -12
 199              		.cfi_offset 5, -8
 200              		.cfi_offset 14, -4
 201 0002 8BB0     		sub	sp, sp, #44
 202              	.LCFI9:
 203              		.cfi_def_cfa_offset 56
 204 0004 0446     		mov	r4, r0
 132:data_logger.c **** /*------------------------------------------------------------------------------
 133:data_logger.c ****  Local variables 
 134:data_logger.c **** ------------------------------------------------------------------------------*/
 135:data_logger.c **** SENSOR_STATUS sensor_status; /* Sensor API return codes    */
 205              		.loc 1 135 1 is_stmt 1 view .LVU40
 136:data_logger.c **** uint32_t      time;          /* Time of data acquisition   */
 206              		.loc 1 136 1 view .LVU41
 137:data_logger.c **** SENSOR_DATA   sensor_data;   /* Sensor data                */
 207              		.loc 1 137 1 view .LVU42
ARM GAS  /tmp/ccKqyHz1.s 			page 7


 138:data_logger.c **** 
 139:data_logger.c **** 
 140:data_logger.c **** /*------------------------------------------------------------------------------
 141:data_logger.c ****  Initializations 
 142:data_logger.c **** ------------------------------------------------------------------------------*/
 143:data_logger.c **** sensor_status = SENSOR_OK;
 208              		.loc 1 143 1 view .LVU43
 209              	.LVL9:
 144:data_logger.c **** time          = 0;
 210              		.loc 1 144 1 view .LVU44
 145:data_logger.c **** memset( &sensor_data, 0, sizeof( SENSOR_DATA ) );
 211              		.loc 1 145 1 view .LVU45
 212 0006 2822     		movs	r2, #40
 213 0008 0021     		movs	r1, #0
 214 000a 6846     		mov	r0, sp
 215              	.LVL10:
 216              		.loc 1 145 1 is_stmt 0 view .LVU46
 217 000c FFF7FEFF 		bl	memset
 218              	.LVL11:
 146:data_logger.c **** 
 147:data_logger.c **** 
 148:data_logger.c **** /*------------------------------------------------------------------------------
 149:data_logger.c ****  Implementation 
 150:data_logger.c **** ------------------------------------------------------------------------------*/
 151:data_logger.c **** 
 152:data_logger.c **** /* Set time     */
 153:data_logger.c **** time = HAL_GetTick() - data_logger_start_time;
 219              		.loc 1 153 1 is_stmt 1 view .LVU47
 220              		.loc 1 153 8 is_stmt 0 view .LVU48
 221 0010 FFF7FEFF 		bl	HAL_GetTick
 222              	.LVL12:
 223              		.loc 1 153 22 view .LVU49
 224 0014 0D4B     		ldr	r3, .L17
 225 0016 1D68     		ldr	r5, [r3]
 226              		.loc 1 153 6 view .LVU50
 227 0018 451B     		subs	r5, r0, r5
 228              	.LVL13:
 154:data_logger.c **** 
 155:data_logger.c **** /* Read sensors */
 156:data_logger.c **** sensor_status = sensor_dump( &sensor_data );
 229              		.loc 1 156 1 is_stmt 1 view .LVU51
 230              		.loc 1 156 17 is_stmt 0 view .LVU52
 231 001a 6846     		mov	r0, sp
 232 001c FFF7FEFF 		bl	sensor_dump
 233              	.LVL14:
 157:data_logger.c **** if ( sensor_status != SENSOR_OK )
 234              		.loc 1 157 1 is_stmt 1 view .LVU53
 235              		.loc 1 157 4 is_stmt 0 view .LVU54
 236 0020 88B9     		cbnz	r0, .L15
 237 0022 8646     		mov	lr, r0
 158:data_logger.c ****     {
 159:data_logger.c ****     return DATA_LOG_SENSOR_ERROR;
 160:data_logger.c ****     }
 161:data_logger.c **** 
 162:data_logger.c **** /* Export Data  */
 163:data_logger.c **** data_ptr -> time = time;
 238              		.loc 1 163 1 is_stmt 1 view .LVU55
ARM GAS  /tmp/ccKqyHz1.s 			page 8


 239              		.loc 1 163 18 is_stmt 0 view .LVU56
 240 0024 A446     		mov	ip, r4
 241 0026 4CF8045B 		str	r5, [ip], #4
 164:data_logger.c **** data_ptr -> sensor_data = sensor_data;
 242              		.loc 1 164 1 is_stmt 1 view .LVU57
 243              		.loc 1 164 25 is_stmt 0 view .LVU58
 244 002a 6C46     		mov	r4, sp
 245              	.LVL15:
 246              		.loc 1 164 25 view .LVU59
 247 002c 0FCC     		ldmia	r4!, {r0, r1, r2, r3}
 248              	.LVL16:
 249              		.loc 1 164 25 view .LVU60
 250 002e ACE80F00 		stmia	ip!, {r0, r1, r2, r3}
 251              	.LVL17:
 252              		.loc 1 164 25 view .LVU61
 253 0032 0FCC     		ldmia	r4!, {r0, r1, r2, r3}
 254 0034 ACE80F00 		stmia	ip!, {r0, r1, r2, r3}
 255              	.LVL18:
 256              		.loc 1 164 25 view .LVU62
 257 0038 94E80300 		ldm	r4, {r0, r1}
 258 003c 8CE80300 		stm	ip, {r0, r1}
 165:data_logger.c **** return DATA_LOG_OK;
 259              		.loc 1 165 1 is_stmt 1 view .LVU63
 260              	.LVL19:
 261              	.L14:
 166:data_logger.c **** } /* data_logger_get_data */
 262              		.loc 1 166 1 is_stmt 0 view .LVU64
 263 0040 7046     		mov	r0, lr
 264 0042 0BB0     		add	sp, sp, #44
 265              	.LCFI10:
 266              		.cfi_remember_state
 267              		.cfi_def_cfa_offset 12
 268              		@ sp needed
 269 0044 30BD     		pop	{r4, r5, pc}
 270              	.LVL20:
 271              	.L15:
 272              	.LCFI11:
 273              		.cfi_restore_state
 159:data_logger.c ****     }
 274              		.loc 1 159 12 view .LVU65
 275 0046 4FF0030E 		mov	lr, #3
 276 004a F9E7     		b	.L14
 277              	.L18:
 278              		.align	2
 279              	.L17:
 280 004c 00000000 		.word	data_logger_start_time
 281              		.cfi_endproc
 282              	.LFE335:
 284              		.section	.text.data_logger_get_time,"ax",%progbits
 285              		.align	1
 286              		.global	data_logger_get_time
 287              		.syntax unified
 288              		.thumb
 289              		.thumb_func
 291              	data_logger_get_time:
 292              	.LFB336:
 167:data_logger.c **** 
ARM GAS  /tmp/ccKqyHz1.s 			page 9


 168:data_logger.c **** 
 169:data_logger.c **** /*******************************************************************************
 170:data_logger.c **** *                                                                              *
 171:data_logger.c **** * PROCEDURE:                                                                   *
 172:data_logger.c **** * 		data_logger_get_time                                                   *
 173:data_logger.c **** *                                                                              *
 174:data_logger.c **** * DESCRIPTION:                                                                 *
 175:data_logger.c **** *       Returns the current time since timer was started                       *
 176:data_logger.c **** *                                                                              *
 177:data_logger.c **** *******************************************************************************/
 178:data_logger.c **** uint32_t data_logger_get_time
 179:data_logger.c ****     (
 180:data_logger.c ****     void
 181:data_logger.c ****     )
 182:data_logger.c **** {
 293              		.loc 1 182 1 is_stmt 1 view -0
 294              		.cfi_startproc
 295              		@ args = 0, pretend = 0, frame = 0
 296              		@ frame_needed = 0, uses_anonymous_args = 0
 297 0000 08B5     		push	{r3, lr}
 298              	.LCFI12:
 299              		.cfi_def_cfa_offset 8
 300              		.cfi_offset 3, -8
 301              		.cfi_offset 14, -4
 183:data_logger.c **** return HAL_GetTick() - data_logger_start_time;
 302              		.loc 1 183 1 view .LVU67
 303              		.loc 1 183 8 is_stmt 0 view .LVU68
 304 0002 FFF7FEFF 		bl	HAL_GetTick
 305              	.LVL21:
 306              		.loc 1 183 22 view .LVU69
 307 0006 024B     		ldr	r3, .L21
 308 0008 1B68     		ldr	r3, [r3]
 184:data_logger.c **** } /* data_logger_get_time */
 309              		.loc 1 184 1 view .LVU70
 310 000a C01A     		subs	r0, r0, r3
 311 000c 08BD     		pop	{r3, pc}
 312              	.L22:
 313 000e 00BF     		.align	2
 314              	.L21:
 315 0010 00000000 		.word	data_logger_start_time
 316              		.cfi_endproc
 317              	.LFE336:
 319              		.section	.text.data_logger_erase_flash,"ax",%progbits
 320              		.align	1
 321              		.global	data_logger_erase_flash
 322              		.syntax unified
 323              		.thumb
 324              		.thumb_func
 326              	data_logger_erase_flash:
 327              	.LFB337:
 185:data_logger.c **** 
 186:data_logger.c **** 
 187:data_logger.c **** /*******************************************************************************
 188:data_logger.c **** *                                                                              *
 189:data_logger.c **** * PROCEDURE:                                                                   *
 190:data_logger.c **** * 		data_logger_erase_flash                                                *
 191:data_logger.c **** *                                                                              *
ARM GAS  /tmp/ccKqyHz1.s 			page 10


 192:data_logger.c **** * DESCRIPTION:                                                                 *
 193:data_logger.c **** *       Erases the flash chip and sets up pointers                             *
 194:data_logger.c **** *                                                                              *
 195:data_logger.c **** *******************************************************************************/
 196:data_logger.c **** DATA_LOG_STATUS data_logger_erase_flash
 197:data_logger.c ****     (
 198:data_logger.c ****     void
 199:data_logger.c ****     )
 200:data_logger.c **** {
 328              		.loc 1 200 1 is_stmt 1 view -0
 329              		.cfi_startproc
 330              		@ args = 0, pretend = 0, frame = 16
 331              		@ frame_needed = 0, uses_anonymous_args = 0
 332 0000 10B5     		push	{r4, lr}
 333              	.LCFI13:
 334              		.cfi_def_cfa_offset 8
 335              		.cfi_offset 4, -8
 336              		.cfi_offset 14, -4
 337 0002 84B0     		sub	sp, sp, #16
 338              	.LCFI14:
 339              		.cfi_def_cfa_offset 24
 201:data_logger.c **** /*------------------------------------------------------------------------------
 202:data_logger.c ****  Local variables 
 203:data_logger.c **** ------------------------------------------------------------------------------*/
 204:data_logger.c **** FLASH_STATUS  flash_status;                 /* Flash API return codes         */
 340              		.loc 1 204 1 view .LVU72
 205:data_logger.c **** HFLASH_BUFFER flash_handle;                 /* Flash API struct               */
 341              		.loc 1 205 1 view .LVU73
 206:data_logger.c **** 
 207:data_logger.c **** 
 208:data_logger.c **** /*------------------------------------------------------------------------------
 209:data_logger.c ****  Initializations 
 210:data_logger.c **** ------------------------------------------------------------------------------*/
 211:data_logger.c **** flash_status = FLASH_OK;
 342              		.loc 1 211 1 view .LVU74
 343              	.LVL22:
 212:data_logger.c **** memset( &flash_handle, 0, sizeof( HFLASH_BUFFER ) );
 344              		.loc 1 212 1 view .LVU75
 345 0004 0023     		movs	r3, #0
 346 0006 0093     		str	r3, [sp]
 347 0008 0193     		str	r3, [sp, #4]
 348 000a 0293     		str	r3, [sp, #8]
 349 000c 0393     		str	r3, [sp, #12]
 213:data_logger.c **** 
 214:data_logger.c **** 
 215:data_logger.c **** /*------------------------------------------------------------------------------
 216:data_logger.c ****  Implementation
 217:data_logger.c **** ------------------------------------------------------------------------------*/
 218:data_logger.c **** 
 219:data_logger.c **** /* Issue the full-chip erase command */
 220:data_logger.c **** flash_status = flash_erase( &flash_handle );
 350              		.loc 1 220 1 view .LVU76
 351              		.loc 1 220 16 is_stmt 0 view .LVU77
 352 000e 6846     		mov	r0, sp
 353 0010 FFF7FEFF 		bl	flash_erase
 354              	.LVL23:
 221:data_logger.c **** if ( flash_status != FLASH_OK )
ARM GAS  /tmp/ccKqyHz1.s 			page 11


 355              		.loc 1 221 1 is_stmt 1 view .LVU78
 356              		.loc 1 221 4 is_stmt 0 view .LVU79
 357 0014 0446     		mov	r4, r0
 358 0016 30B9     		cbnz	r0, .L26
 359              	.LVL24:
 360              	.L25:
 222:data_logger.c ****     {
 223:data_logger.c ****     return DATA_LOG_FLASH_ERROR;
 224:data_logger.c ****     }
 225:data_logger.c **** 
 226:data_logger.c **** /* Wait until the flash chip is fully erased */
 227:data_logger.c **** while ( !flash_is_flash_busy() ){}
 361              		.loc 1 227 34 is_stmt 1 discriminator 1 view .LVU80
 362              		.loc 1 227 9 discriminator 1 view .LVU81
 363              		.loc 1 227 10 is_stmt 0 discriminator 1 view .LVU82
 364 0018 FFF7FEFF 		bl	flash_is_flash_busy
 365              	.LVL25:
 366              		.loc 1 227 9 discriminator 1 view .LVU83
 367 001c 0028     		cmp	r0, #0
 368 001e FBD0     		beq	.L25
 369              	.L24:
 228:data_logger.c **** return DATA_LOG_OK;
 229:data_logger.c **** } /* data_logger_erase_flash */
 370              		.loc 1 229 1 view .LVU84
 371 0020 2046     		mov	r0, r4
 372 0022 04B0     		add	sp, sp, #16
 373              	.LCFI15:
 374              		.cfi_remember_state
 375              		.cfi_def_cfa_offset 8
 376              		@ sp needed
 377 0024 10BD     		pop	{r4, pc}
 378              	.LVL26:
 379              	.L26:
 380              	.LCFI16:
 381              		.cfi_restore_state
 223:data_logger.c ****     }
 382              		.loc 1 223 12 view .LVU85
 383 0026 0224     		movs	r4, #2
 384 0028 FAE7     		b	.L24
 385              		.cfi_endproc
 386              	.LFE337:
 388              		.section	.bss.data_logger_start_time,"aw",%nobits
 389              		.align	2
 392              	data_logger_start_time:
 393 0000 00000000 		.space	4
 394              		.section	.bss.data_logger_rel_addr,"aw",%nobits
 395              		.align	2
 398              	data_logger_rel_addr:
 399 0000 00000000 		.space	4
 400              		.section	.bss.data_logger_addr,"aw",%nobits
 401              		.align	2
 404              	data_logger_addr:
 405 0000 00000000 		.space	4
 406              		.text
 407              	.Letext0:
 408              		.file 2 "/usr/lib/gcc/arm-none-eabi/12.2.1/include/stddef.h"
 409              		.file 3 "/usr/lib/gcc/arm-none-eabi/12.2.1/include/stdint.h"
ARM GAS  /tmp/ccKqyHz1.s 			page 12


 410              		.file 4 "../../../mod/sensor/sensor.h"
 411              		.file 5 "data_logger.h"
 412              		.file 6 "../../../mod/flash/flash.h"
 413              		.file 7 "/usr/include/newlib/string.h"
 414              		.file 8 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal.h"
 415              		.file 9 "<built-in>"
ARM GAS  /tmp/ccKqyHz1.s 			page 13


DEFINED SYMBOLS
                            *ABS*:0000000000000000 data_logger.c
     /tmp/ccKqyHz1.s:20     .text.data_logger_init_timer:0000000000000000 $t
     /tmp/ccKqyHz1.s:26     .text.data_logger_init_timer:0000000000000000 data_logger_init_timer
     /tmp/ccKqyHz1.s:49     .text.data_logger_init_timer:000000000000000c $d
     /tmp/ccKqyHz1.s:392    .bss.data_logger_start_time:0000000000000000 data_logger_start_time
     /tmp/ccKqyHz1.s:54     .text.data_logger_log_data:0000000000000000 $t
     /tmp/ccKqyHz1.s:60     .text.data_logger_log_data:0000000000000000 data_logger_log_data
     /tmp/ccKqyHz1.s:175    .text.data_logger_log_data:0000000000000078 $d
     /tmp/ccKqyHz1.s:404    .bss.data_logger_addr:0000000000000000 data_logger_addr
     /tmp/ccKqyHz1.s:398    .bss.data_logger_rel_addr:0000000000000000 data_logger_rel_addr
     /tmp/ccKqyHz1.s:181    .text.data_logger_get_data:0000000000000000 $t
     /tmp/ccKqyHz1.s:187    .text.data_logger_get_data:0000000000000000 data_logger_get_data
     /tmp/ccKqyHz1.s:280    .text.data_logger_get_data:000000000000004c $d
     /tmp/ccKqyHz1.s:285    .text.data_logger_get_time:0000000000000000 $t
     /tmp/ccKqyHz1.s:291    .text.data_logger_get_time:0000000000000000 data_logger_get_time
     /tmp/ccKqyHz1.s:315    .text.data_logger_get_time:0000000000000010 $d
     /tmp/ccKqyHz1.s:320    .text.data_logger_erase_flash:0000000000000000 $t
     /tmp/ccKqyHz1.s:326    .text.data_logger_erase_flash:0000000000000000 data_logger_erase_flash
     /tmp/ccKqyHz1.s:389    .bss.data_logger_start_time:0000000000000000 $d
     /tmp/ccKqyHz1.s:395    .bss.data_logger_rel_addr:0000000000000000 $d
     /tmp/ccKqyHz1.s:401    .bss.data_logger_addr:0000000000000000 $d

UNDEFINED SYMBOLS
HAL_GetTick
flash_is_flash_busy
flash_write
memset
sensor_dump
flash_erase
